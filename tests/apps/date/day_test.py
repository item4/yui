import os

import pytest

from yui.apps.date.day import day
from yui.event import create_event

from ...util import FakeBot


@pytest.fixture()
def fx_tdcproject_key():
    key = os.getenv('TDCPROJECT_KEY')
    if not key:
        pytest.skip('Can not test this without TDCPROJECT_KEY envvar')
    return key


@pytest.mark.asyncio
async def test_day_command(fx_config, fx_tdcproject_key):
    fx_config.TDCPROJECT_KEY = fx_tdcproject_key
    bot = FakeBot(fx_config)
    bot.add_channel('C1', 'general')
    event = create_event({
        'type': 'message',
        'channel': 'C1',
        'ts': '1234.5678',
    })

    # Nobody know infomation of random day.
    # So we test just work or not work.
    await day(bot, event, '')
    said = bot.call_queue.pop()
    assert said.method == 'chat.postMessage'
    assert said.data['channel'] == 'C1'
    assert said.data['text']

    # Year only
    await day(bot, event, '2017년')
    said = bot.call_queue.pop()
    assert said.method == 'chat.postMessage'
    assert said.data['channel'] == 'C1'
    assert said.data['text'] == """\
- 2017-01-01: 신정 (국정공휴일)
- 2017-01-05: 소한 (절기)
- 2017-01-14: 다이어리 데이 (대중문화)
- 2017-01-20: 대한 (절기)
- 2017-01-27: 설날연휴 (국정공휴일)
- 2017-01-28: 설날 (국정공휴일, 명절)
- 2017-01-29: 설날연휴 (국정공휴일)
- 2017-01-30: 설날연휴 대체공휴일 (대체공휴일)
- 2017-02-02: 세계습지의 날 (이벤트)
- 2017-02-04: 입춘 (절기)
- 2017-02-11: 정월 대보름 (명절)
- 2017-02-14: 발렌타인데이 (대중문화)
- 2017-02-18: 우수 (절기)
- 2017-03-01: 삼일절 (국정공휴일, 국경일)
- 2017-03-03: 납세자의 날 (기념일)
- 2017-03-03: 삼겹살데이 (대중문화)
- 2017-03-05: 경칩 (절기)
- 2017-03-08: 세계 여성의 날 (이벤트)
- 2017-03-14: 파이데이 (대중문화)
- 2017-03-14: 화이트데이 (대중문화)
- 2017-03-15: 3.15 의거 기념일 (기념일)
- 2017-03-15: 상공의 날 (기념일)
- 2017-03-20: 춘분 (절기)
- 2017-03-21: 암예방의 날 (이벤트)
- 2017-03-22: 세계 물의 날 (이벤트)
- 2017-03-23: 세계 기상의 날 (이벤트)
- 2017-03-24: 세계 결핵의 날 (이벤트)
- 2017-04-01: 만우절 (이벤트)
- 2017-04-01: 어업인의 날 (이벤트)
- 2017-04-02: 세계 자폐증 인식의 날 (이벤트)
- 2017-04-03: 제주 4.3 사건 (기념일)
- 2017-04-04: 정신건강의 날 (이벤트)
- 2017-04-04: 청명 (절기)
- 2017-04-05: 식목일 (기념일)
- 2017-04-05: 한식 (명절)
- 2017-04-07: 보건의 날 (기념일)
- 2017-04-07: 신문의 날 (이벤트)
- 2017-04-07: 향토예비군의 날 (기념일)
- 2017-04-13: 임시정부 수립일 (기념일)
- 2017-04-14: 블랙데이 (대중문화)
- 2017-04-19: 4.19 혁명 (기념일)
- 2017-04-20: 곡우 (절기)
- 2017-04-20: 장애인의 날 (기념일)
- 2017-04-21: 과학의 날 (기념일)
- 2017-04-22: 정보통신의 날 (기념일)
- 2017-04-22: 지구의 날 (이벤트)
- 2017-04-23: 세계 책과 저작권의 날 (이벤트)
- 2017-04-25: 법의 날 (기념일)
- 2017-04-25: 세계 말라리아의 날 (이벤트)
- 2017-04-26: 세계 지적재산권의 날 (이벤트)
- 2017-04-28: 충무공 탄신일 (기념일)
- 2017-05-01: 근로자의 날 (기념일)
- 2017-05-02: 오리데이 (대중문화)
- 2017-05-02: 오이데이 (대중문화)
- 2017-05-03: 석가탄신일 (국정공휴일)
- 2017-05-05: 어린이날 (국정공휴일, 기념일)
- 2017-05-05: 입하 (절기)
- 2017-05-08: 어버이날 (기념일)
- 2017-05-09: 제 19 대 대통령 선거 (국정공휴일)
- 2017-05-10: 유권자의 날 (이벤트)
- 2017-05-11: 입양의 날 (이벤트)
- 2017-05-12: 자동차의 날 (이벤트)
- 2017-05-13: 세계 공정무역의 날 (이벤트)
- 2017-05-14: 로즈데이 (대중문화)
- 2017-05-14: 식품안전의 날 (이벤트)
- 2017-05-15: 성년의 날 (기념일)
- 2017-05-15: 세계 가정의 날 (이벤트)
- 2017-05-15: 스승의날 (기념일)
- 2017-05-18: 5.18 민주화 운동 기념일 (기념일)
- 2017-05-19: 발명의 날 (이벤트)
- 2017-05-20: 세계인의 날 (이벤트)
- 2017-05-21: 부부의 날 (기념일)
- 2017-05-21: 소만 (절기)
- 2017-05-22: 가정위탁의 날 (이벤트)
- 2017-05-22: 생물종 다양성 보존의 날 (이벤트)
- 2017-05-25: 방재의 날 (이벤트)
- 2017-05-25: 실종아동의 날 (이벤트)
- 2017-05-30: 단오 (명절)
- 2017-05-31: 바다의 날 (기념일)
- 2017-05-31: 세계 금연의 날 (이벤트)
- 2017-06-01: 세계 우유의 날 (이벤트)
- 2017-06-01: 의병의 날 (기념일)
- 2017-06-05: 망종 (절기)
- 2017-06-05: 세계 환경의 날 (기념일)
- 2017-06-06: 현충일 (국정공휴일, 기념일)
- 2017-06-09: 치아의 날 (이벤트)
- 2017-06-10: 6.10 민주항쟁 기념일 (기념일)
- 2017-06-12: 세계 아동 노동반대의 날 (이벤트)
- 2017-06-14: 세계 헌혈자의 날 (이벤트)
- 2017-06-14: 키스데이 (대중문화)
- 2017-06-15: 세계 노인학대 인식의 날 (이벤트)
- 2017-06-17: 세계 사막화 방지의 날 (이벤트)
- 2017-06-18: 건설의 날 (이벤트)
- 2017-06-20: 세계 난민의 날 (이벤트)
- 2017-06-21: 하지 (절기)
- 2017-06-25: 6.25 한국전쟁 (기념일)
- 2017-07-07: 소서 (절기)
- 2017-07-12: 정보보호의 날 (기념일)
- 2017-07-12: 초복 (명절)
- 2017-07-14: 실버데이 (대중문화)
- 2017-07-17: 제헌절 (국경일)
- 2017-07-22: 중복 (명절)
- 2017-07-23: 대서 (절기)
- 2017-08-01: 말복 (명절)
- 2017-08-06: 유두절 (이벤트)
- 2017-08-07: 입추 (절기)
- 2017-08-12: 국제 청소년의 날 (이벤트)
- 2017-08-12: 이산가족의 날 (이벤트)
- 2017-08-14: 그린데이 (대중문화)
- 2017-08-14: 뮤직데이 (대중문화)
- 2017-08-15: 광복절 (국정공휴일, 국경일)
- 2017-08-22: 에너지의 날 (이벤트)
- 2017-08-23: 야구의 날 (이벤트)
- 2017-08-23: 처서 (절기)
- 2017-08-28: 칠석 (이벤트)
- 2017-09-01: 통계의 날 (이벤트)
- 2017-09-04: 콜레스테롤의 날 (이벤트)
- 2017-09-04: 태권도의 날 (이벤트)
- 2017-09-06: 자원 순환의 날 (이벤트)
- 2017-09-07: 백로 (절기)
- 2017-09-07: 사회복지의 날 (이벤트)
- 2017-09-09: 구구데이 (대중문화)
- 2017-09-10: 세계자살 예방의 날 (이벤트)
- 2017-09-10: 해양경찰의 날  (이벤트)
- 2017-09-14: 포토데이 (대중문화)
- 2017-09-16: 세계 오존층보존의 날 (이벤트)
- 2017-09-18: 철도의 날 (기념일)
- 2017-09-22: 승용차 없는 날 (이벤트)
- 2017-09-23: 추분 (절기)
- 2017-09-26: 세계 피임의 날 (이벤트)
- 2017-09-27: 관광의 날 (이벤트)
- 2017-10-01: 국군의 날 (기념일)
- 2017-10-02: 노인의 날 (기념일)
- 2017-10-02: 추석연휴(임시공휴일) (국정공휴일)
- 2017-10-03: 개천절 (국정공휴일, 국경일)
- 2017-10-03: 추석연휴 (국정공휴일)
- 2017-10-04: 천사데이 (대중문화)
- 2017-10-04: 추석 (국정공휴일, 명절)
- 2017-10-05: 교과서의 날 (이벤트)
- 2017-10-05: 세계 한인의 날 (기념일)
- 2017-10-05: 추석연휴 (국정공휴일)
- 2017-10-06: 추석연휴 대체공휴일 (대체공휴일)
- 2017-10-08: 재향 군인의 날 (기념일)
- 2017-10-08: 한로 (절기)
- 2017-10-09: 한글날 (국정공휴일, 국경일)
- 2017-10-10: 임산부의 날 (이벤트)
- 2017-10-10: 한방의 날 (이벤트)
- 2017-10-11: 세계 여자아이의 날 (이벤트)
- 2017-10-14: 와인데이 (대중문화)
- 2017-10-15: 체육의 날 (기념일)
- 2017-10-15: 흰지팡이의 날(시각장애인) (이벤트)
- 2017-10-17: 세계 빈곤 퇴치의 날 (이벤트)
- 2017-10-18: 산의 날 (이벤트)
- 2017-10-20: 세계 통계의 날 (이벤트)
- 2017-10-20: 초경의 날 (이벤트)
- 2017-10-21: 경찰의 날 (기념일)
- 2017-10-21: 문화의 날 (기념일)
- 2017-10-23: 상강 (절기)
- 2017-10-24: 국제연합일 (기념일)
- 2017-10-24: 사과데이 (대중문화)
- 2017-10-25: 독도의 날 (이벤트)
- 2017-10-28: 교정의 날 (기념일)
- 2017-10-28: 중양절 (이벤트)
- 2017-10-29: 지방자치의 날 (기념일)
- 2017-10-31: 저축의 날 (기념일)
- 2017-10-31: 할로윈 (이벤트)
- 2017-11-03: 만화의 날 (이벤트)
- 2017-11-03: 학생 독립기념일 (기념일)
- 2017-11-07: 입동 (절기)
- 2017-11-09: 소방의 날 (이벤트)
- 2017-11-11: 가래떡데이 (대중문화)
- 2017-11-11: 농업인의 날 (기념일)
- 2017-11-11: 빼빼로 데이 (대중문화)
- 2017-11-11: 지체장애인의 날 (이벤트)
- 2017-11-14: 무비데이 (대중문화)
- 2017-11-14: 쿠키데이 (대중문화)
- 2017-11-17: 순국선열의 날 (기념일)
- 2017-11-22: 소설 (절기)
- 2017-12-01: 세계 에이즈의 날 (이벤트)
- 2017-12-03: 세계 장애인의 날 (이벤트)
- 2017-12-03: 소비자의 날 (기념일)
- 2017-12-05: 무역의 날 (기념일)
- 2017-12-07: 대설 (절기)
- 2017-12-10: 세계 인권선언일 (이벤트)
- 2017-12-14: 허그데이 (대중문화)
- 2017-12-18: 세계 이주민의 날 (이벤트)
- 2017-12-22: 동지 (절기)
- 2017-12-25: 성탄절 (국정공휴일)
- 2017-12-27: 원자력의 날 (기념일)"""
    assert said.data['thread_ts'] == '1234.5678'

    # Year + month
    await day(bot, event, '2017년 1월')
    said = bot.call_queue.pop()
    assert said.method == 'chat.postMessage'
    assert said.data['channel'] == 'C1'
    assert said.data['text'] == """\
- 2017-01-01: 신정 (국정공휴일)
- 2017-01-05: 소한 (절기)
- 2017-01-14: 다이어리 데이 (대중문화)
- 2017-01-20: 대한 (절기)
- 2017-01-27: 설날연휴 (국정공휴일)
- 2017-01-28: 설날 (국정공휴일, 명절)
- 2017-01-29: 설날연휴 (국정공휴일)
- 2017-01-30: 설날연휴 대체공휴일 (대체공휴일)"""
    assert said.data['thread_ts'] == '1234.5678'

    # full date
    await day(bot, event, '2017년 10월 1일')
    said = bot.call_queue.pop()
    assert said.method == 'chat.postMessage'
    assert said.data['channel'] == 'C1'
    assert said.data['text'] == '- 2017-10-01: 국군의 날 (기념일)'
    assert said.data['thread_ts'] == '1234.5678'
